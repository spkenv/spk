template:
  versions:
    discover:
      gitTags: v1\.\d+\.\d+
      url: https://github.com/madler/zlib
      extract: v(\d+\.\d+\.?\d*)

pkg: zlib/{{ version }}
api: v0/package
meta:
  description: "Compression library"
  license: Zlib
  homepage: https://www.zlib.net

sources:
  # This idiom can work with any of (a) a local clone, (b) a git submodule,
  # or (c) nothing (does a fresh clone).
  - path: ./
  - script:
      - if [ ! -d zlib ] ; then git clone https://github.com/madler/zlib.git -b v{{ version }} ; fi

build:
  options:
    - pkg: stdfs
    - pkg: gcc
    - pkg: cmake/^3.13
  # Because this is a pure C library, just build with any gcc and don't
  # specify multiple gcc variants.
  script:
    - cmake -S zlib -B build
      -DCMAKE_BUILD_TYPE=Release
      -DCMAKE_INSTALL_PREFIX=${PREFIX}
    - cmake --build build --target install

install:
  requirements:
    - pkg: stdfs
    # Omit gcc as install requirements because it's a pure C library and
    # will get libc from the system install.
